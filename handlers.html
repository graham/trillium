<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>A tour of handler libraries - trillium</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="welcome.html"><strong aria-hidden="true">1.</strong> Welcome</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="who.html"><strong aria-hidden="true">1.1.</strong> Who is behind this</a></li><li class="chapter-item expanded "><a href="conventions.html"><strong aria-hidden="true">1.2.</strong> About this document</a></li><li class="chapter-item expanded "><a href="naming.html"><strong aria-hidden="true">1.3.</strong> Naming</a></li></ol></li><li class="chapter-item expanded "><a href="architecture.html"><strong aria-hidden="true">2.</strong> Architectural Overview</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="core_concepts.html"><strong aria-hidden="true">2.1.</strong> Core Concepts</a></li></ol></li><li class="chapter-item expanded "><a href="handlers.html" class="active"><strong aria-hidden="true">3.</strong> A tour of handler libraries</a></li><li class="chapter-item expanded "><a href="example.html"><strong aria-hidden="true">4.</strong> Building an example app</a></li><li class="chapter-item expanded "><a href="contributing.html"><strong aria-hidden="true">5.</strong> Contributing</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">trillium</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="a-tour-of-some-of-the-handlers-that-exist-today"><a class="header" href="#a-tour-of-some-of-the-handlers-that-exist-today">A tour of some of the handlers that exist today</a></h1>
<p>In order for trillium to be a usable web framework, we offer a number of
core utilities. However, it is our hope that alternative
implementations for at least some of these will exist in order to
explore the design space and accommodate different design constraints
and tradeoffs. Because not every application will need this
functionality, they are each released as distinct libraries from the
core of trillium.</p>
<h2 id="routers"><a class="header" href="#routers">Routers</a></h2>
<p>The trillium router is based on
<a href="https://github.com/jbr/routefinder">routefinder</a>. This router
supports two types of patterns: Untyped params and a single
wildcard. Named params are captured in a map-like interface. Any
handler can be mounted inside of a Router (including other Routers),
allowing entire applications to be mounted on a path, and allowing for
sequences to be run on a given route. Any handler mounted inside of a
route that includes a <code>*</code> will have the url rewritten to the contents
of that star.</p>
<p>Alternative routers that are not based on routefinder are a prime
opportunity for innovation and exploration.</p>
<p>Here's a simple example of an application that responds to a request
like http://localhost:8000/greet/earth with &quot;hello earth&quot; and
http://localhost:8000/greet/mars with &quot;hello mars&quot; and responds to
http://localhost:8000 with &quot;hello everyone&quot;</p>
<pre><pre class="playground"><code class="language-rust edition2018">use trillium::Conn;
use trillium_router::{Router, RouterConnExt};

pub fn main() {
    env_logger::init();
    trillium_smol_server::run(
        Router::new()
            .get(&quot;/&quot;, |conn: Conn| async move { conn.ok(&quot;hello everyone&quot;) })
            .get(&quot;/hello/:planet&quot;, |conn: Conn| async move {
                let planet = conn.param(&quot;planet&quot;).unwrap();
                let response_body = format!(&quot;hello {}&quot;, planet);
                conn.ok(response_body)
            }),
    );
}
</code></pre></pre>
<h3 id="experimental-macro"><a class="header" href="#experimental-macro">Experimental macro</a></h3>
<p>Because routers are very common, there's also a macro. Currently, the
above example with a macro looks like:</p>
<pre><pre class="playground"><code class="language-rust edition2018">use trillium::Conn;
use trillium_router::{routes, RouterConnExt};

pub fn main() {
    env_logger::init();
    trillium_smol_server::run(routes![
        get &quot;/&quot; |conn: Conn| async move { conn.ok(&quot;hello everyone&quot;) },

        get &quot;/hello/:planet&quot; |conn: Conn| async move {
            let planet = conn.param(&quot;planet&quot;).unwrap();
            let response_body = format!(&quot;hello {}&quot;, planet);
            conn.ok(response_body)
        }
    ]);
}
</code></pre></pre>
<blockquote>
<p>🚧 Feedback and improvements on the syntax are very welcome.</p>
</blockquote>
<h2 id="cookies"><a class="header" href="#cookies">Cookies</a></h2>
<pre><pre class="playground"><code class="language-rust edition2018">use trillium::{sequence, Conn};
use trillium_cookies::{Cookie, Cookies, CookiesConnExt};

pub fn main() {
    env_logger::init();

    trillium_smol_server::run(sequence![Cookies, |conn: Conn| async move {
        if let Some(cookie_value) = conn.cookies().get(&quot;some_cookie&quot;) {
            println!(&quot;current cookie value: {}&quot;, cookie_value.value());
        }

        conn.ok(&quot;ok!&quot;).with_cookie(
            Cookie::build(&quot;some_cookie&quot;, &quot;some-cookie-value&quot;)
                .path(&quot;/&quot;)
                .finish(),
        )
    }]);
}
</code></pre></pre>
<h2 id="sessions"><a class="header" href="#sessions">Sessions</a></h2>
<p>Sessions are a common convention in web frameworks, allowing for a
safe and secure way to associate server-side data with a given http
client (browser). Trillium's session storage is built on the
<code>async-session</code> crate, which allows us to share session stores with
tide. Currently, these session stores exist:</p>
<ul>
<li>MemoryStore (reexported as trillium_sessions::MemoryStore) <sup class="footnote-reference"><a href="#1">1</a></sup></li>
<li>CookieStore (reexported as trillium_sessions::CookieStore) <sup class="footnote-reference"><a href="#1">1</a></sup></li>
<li>PostgresSessionStore and SqliteSessionStore from <a href="https://github.com/jbr/async-sqlx-session">async-sqlx-session</a></li>
<li>RedisSessionStore from <a href="https://github.com/jbr/async-redis-session">async-redis-session</a></li>
<li>MongodbSessionStore from <a href="https://github.com/http-rs/async-mongodb-session">async-mongodb-session</a></li>
</ul>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>The memory store and cookie store should be avoided for use in
production applications. The memory store will lose all session
state on server process restart, and the cookie store makes
different security tradeoffs than the database-backed stores. If
possible, use a database.</p>
</div>
<blockquote>
<p>❗The session handler <em>must</em> be used in conjunction with the cookie
handler, and it must run <em>after</em> the cookie handler. This particular
interaction is also present in other frameworks, and is due to the
fact that regardless of which session store is used, sessions use a
secure cookie as a unique identifier.</p>
</blockquote>
<pre><pre class="playground"><code class="language-rust edition2018">use trillium::{sequence, Conn};
use trillium_sessions::{MemoryStore, SessionConnExt, Sessions};

pub fn main() {
    env_logger::init();

    trillium_smol_server::run(sequence![
        trillium_cookies::Cookies,
        Sessions::new(MemoryStore::new(), b&quot;01234567890123456789012345678901123&quot;),
        |conn: Conn| async move {
            let count: usize = conn.session().get(&quot;count&quot;).unwrap_or_default();
            conn.with_session(&quot;count&quot;, count + 1)
                .ok(format!(&quot;count: {}&quot;, count))
        }
    ]);
}
</code></pre></pre>
<h2 id="logger"><a class="header" href="#logger">Logger</a></h2>
<p>Currently there's just a DevLogger, but soon there will be more
loggers. Trillium loggers use the <code>log</code> crate and emit one line at the
info log level per http request/response pair. We like to use the
<code>env_logger</code> crate, but any <code>log</code> backend will work equally well.</p>
<pre><pre class="playground"><code class="language-rust edition2018">use trillium::sequence;
use trillium_logger::DevLogger;

pub fn main() {
    env_logger::init();
    trillium_smol_server::run(sequence![DevLogger, &quot;ok&quot;]);
}
</code></pre></pre>
<h2 id="websocket-support"><a class="header" href="#websocket-support">WebSocket support</a></h2>
<p>WebSockets work a lot like tide's, since I recently wrote that
interface as well. One difference in trillium is that the websocket
connection also contains some aspects of the original http request,
such as request headers, the request path and method, and any state
that has been accumulated by previous handlers in a sequence.</p>
<pre><pre class="playground"><code class="language-rust edition2018">use futures_util::StreamExt;
use trillium_websockets::{Message, WebSocket};

pub fn main() {
    env_logger::init();

    trillium_smol_server::run(WebSocket::new(|mut websocket| async move {
        while let Some(Ok(Message::Text(input))) = websocket.next().await {
            websocket
                .send_string(format!(&quot;received your message: {}&quot;, &amp;input))
                .await;
        }
    }));
}
</code></pre></pre>
<h2 id="static-file-serving"><a class="header" href="#static-file-serving">Static file serving</a></h2>
<p>Trillium offers two rudimentary approaches to static file serving for now. Neither of these approaches perform any cache-related header checking yet.</p>
<h3 id="from-disk"><a class="header" href="#from-disk">From disk</a></h3>
<p>This handler loads content from disk at request, and does not yet do any in-memory caching.</p>
<pre><pre class="playground"><code class="language-rust edition2018">use trillium_static::Static;

pub fn main() {
    trillium_smol_server::run(Static::new(&quot;../docs/book/&quot;).with_index_file(&quot;index.html&quot;))
}
</code></pre></pre>
<h3 id="from-memory-at-compile-time"><a class="header" href="#from-memory-at-compile-time">From memory, at compile time</a></h3>
<p>This handler includes all of the static content in the compiled binary, allowing it to be shipped independently from the assets.</p>
<pre><pre class="playground"><code class="language-rust edition2018">use trillium_static_compiled::{include_dir, StaticCompiled};
pub fn main() {
    trillium_smol_server::run(StaticCompiled::new(include_dir!(&quot;./src&quot;)).with_index_file(&quot;lib.rs&quot;));
}
</code></pre></pre>
<h2 id="template-engines"><a class="header" href="#template-engines">Template engines</a></h2>
<p>There are currently three template engines for trillium. Although they are in no way mutually exclusive, most applications will want at most one of these.</p>
<h3 id="askama"><a class="header" href="#askama">Askama</a></h3>
<p>Askama is a jinja-based template engine that preprocesses templates at
compile time, resulting in efficient and type-safe templates that are
compiled into the application binary. We recommend this approach as a
default. Here's how it looks:</p>
<p>Given the following file in <code>(cargo root)/templates/examples/hello.html</code>,</p>
<pre><code class="language-django">Hello, {{ name }}!
</code></pre>
<pre><pre class="playground"><code class="language-rust edition2018">use trillium::Conn;
use trillium_askama::{AskamaConnExt, Template};

#[derive(Template)]
#[template(path = &quot;examples/hello.html&quot;)]
struct HelloTemplate&lt;'a&gt; {
    name: &amp;'a str,
}

fn main() {
    trillium_smol_server::run(
        |conn: Conn| async move { conn.render(HelloTemplate { name: &quot;world&quot; }) },
    );
}
</code></pre></pre>
<h3 id="tera"><a class="header" href="#tera">Tera</a></h3>
<p>Tera offers runtime templating. Trillium's tera integration provides an interface very similar to <code>phoenix</code> or <code>rails</code>, with the notion of <code>assigns</code> being set on the conn prior to render.</p>
<p>Given the following file in the same directory as main.rs (examples in this case),</p>
<pre><code class="language-django">Hello, {{ name }}!
</code></pre>
<pre><pre class="playground"><code class="language-rust edition2018">use trillium::{sequence, Conn};
use trillium_tera::{TeraConnExt, TeraHandler};

fn main() {
    trillium_smol_server::run(sequence![
        TeraHandler::new(&quot;**/*.html&quot;),
        |conn: Conn| async move { conn.assign(&quot;name&quot;, &quot;hi&quot;).render(&quot;examples/hello.html&quot;) }
    ]);
}
</code></pre></pre>
<h3 id="handlebars"><a class="header" href="#handlebars">Handlebars</a></h3>
<p>Handlebars also offers runtime templating. Given the following file in <code>examples/templates/hello.hbs</code>,</p>
<pre><code class="language-handlebars">hello {{name}}!
</code></pre>
<pre><pre class="playground"><code class="language-rust edition2018">use trillium::{sequence, Conn};
use trillium_handlebars::{Handlebars, HandlebarsConnExt};

fn main() {
    env_logger::init();
    trillium_smol_server::run(sequence![
        Handlebars::new(&quot;./examples/templates/*.hbs&quot;),
        |conn: Conn| async move {
            conn.assign(&quot;name&quot;, &quot;world&quot;)
                .render(&quot;examples/templates/hello.hbs&quot;)
        }
    ]);
}
</code></pre></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="core_concepts.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="example.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="core_concepts.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="example.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
